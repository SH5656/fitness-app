<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fitness Habit App</title>

<style>
*{box-sizing:border-box;transition:0.25s}

:root{
  --bg:#e8f5e9; --card:#fff; --accent:#2ecc71; --hover:#27ae60;
}
body{margin:0;background:var(--bg);font-family:Segoe UI,Arial;padding:12px}
.app{
  max-width:480px;margin:auto;background:var(--card);
  padding:16px;border-radius:18px;box-shadow:0 10px 25px rgba(0,0,0,.2)
}

/* BUTTONS */
button{
  width:100%;padding:10px;margin:6px 0;font-size:15px;
  border-radius:10px;border:none;background:var(--accent);color:#fff;
  cursor:pointer;transition:0.2s;
}
button:hover{background:var(--hover)}
button:active{transform:scale(.92);opacity:.8}

/* PROFILE */
.profile{display:flex;align-items:center;gap:12px;margin-bottom:8px}
.profile img{width:60px;height:60px;border-radius:50%;object-fit:cover;background:#ccc;transition:.4s}
.stats{font-size:14px}
.stats div{margin:2px 0}

/* HABIT EDIT POPUP */
#habitEditor{
  background:#fff;padding:10px;border-radius:12px;margin:10px 0;
  box-shadow:0 4px 14px rgba(0,0,0,.2);
  display:none;
}

/* TABLE */
.table-wrap{overflow-x:auto}
table{width:100%;border-collapse:collapse;font-size:13px;min-width:720px}
th,td{border:1px solid #ccc;padding:6px;text-align:center}
th{background:#e7e7e7}
.today{background:#fff4a8}
input[type=checkbox]{transform:scale(1.2);cursor:pointer}
td:hover{background:#d7ffd7}
</style>
</head>
<body>

<div class="app">

<!-- PROFILE -->
<div class="profile">
<img id="profilePic">
<div class="stats">
  <div id="userNameShow">üë§ Your Name</div>
  <div id="streakShow">üî• Streak: 0</div>
  <div id="statsShow">üíß0 | ‚öñÔ∏è0</div>
</div>
</div>

<input type="text" id="userName" placeholder="Enter name">
<input type="file" id="photoInput" accept="image/*">
<button onclick="saveProfile()">Save Profile</button>

<button onclick="editHabits()">‚úèÔ∏è Edit Habits</button>

<div id="habitEditor"></div>

<button onclick="unlockSound()">üîä Enable Tick Sound</button>
<button onclick="changeTheme()">üé® Change Theme</button>

<h2 id="monthYear"></h2>
<h3 id="weekTitle"></h3>

<div style="display:flex;gap:6px">
<button onclick="changeWeek(-1)">‚¨Ö Prev</button>
<button onclick="changeWeek(1)">Next ‚û°</button>
</div>

<!-- HABITS TABLE -->
<div class="table-wrap">
<table>
<thead>
<tr id="habitHeadRow"></tr>
</thead>
<tbody id="chartBody"></tbody>
</table>
</div>

<!-- WATER -->
<input type="number" id="water" placeholder="Water">
<button onclick="saveWater()">Save Water</button>

<!-- WEIGHT -->
<input type="number" step="0.1" id="weight" placeholder="Weight KG">
<button onclick="saveWeight()">Save Weight</button>

<!-- ALARM -->
<input type="time" id="alarmTime">
<button onclick="setAlarm()">‚è∞ Set Alarm</button>

</div>

<audio id="tickSound">
<source src="https://assets.mixkit.co/sfx/preview/mixkit-click-1124.mp3">
</audio>
<audio id="alarmSound">
<source src="https://assets.mixkit.co/sfx/preview/mixkit-alarm-digital-clock-beep-989.mp3">
</audio>

<script>
const days=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];
let habits=8;
let today=new Date(); today.setHours(0,0,0,0);
let weekOffset=0;
let soundReady=false;

/* PROFILE */
function saveProfile(){
let n=userName.value; if(n){localStorage.setItem("name",n);}
let f=photoInput.files[0];
if(f){
  profilePic.classList.add("fadeOut");
  let r=new FileReader();
  r.onload=()=>{
    localStorage.setItem("pic",r.result);
    profilePic.src=r.result;
    profilePic.classList.remove("fadeOut");
  };
  r.readAsDataURL(f);
}
loadProfile();
}
function loadProfile(){
userNameShow.innerText="üë§ "+(localStorage.getItem("name")||"Your Name");
profilePic.src=localStorage.getItem("pic")||"";
updateStats();
updateStreak();
}

/* HABIT EDIT */
function editHabits(){
habitEditor.innerHTML="";
let saved=JSON.parse(localStorage.getItem("habitNames")||"[]");
for(let i=0;i<habits;i++){
habitEditor.innerHTML+=`<input id="h${i}" value="${saved[i]||"Habit "+(i+1)}">`;
}
habitEditor.innerHTML+=`<button onclick="saveHabits()">Save</button>`;
habitEditor.style.display="block";
}
function saveHabits(){
let arr=[];
for(let i=0;i<habits;i++) arr.push(document.getElementById("h"+i).value);
localStorage.setItem("habitNames",JSON.stringify(arr));
habitEditor.style.display="none";
render();
}

/* ALARM */
function setAlarm(){
let t=alarmTime.value;
if(!t) return alert("Set a time first");
localStorage.setItem("alarm",t);
Notification.requestPermission();
alert("Alarm ready! Keep app open or add to Home Screen");
}
setInterval(()=>{
let t=localStorage.getItem("alarm"); if(!t) return;
let n=new Date();
let cur=n.getHours()+":"+String(n.getMinutes()).padStart(2,"0");
if(cur===t){
alarmSound.play();
new Notification("‚è∞ ALARM!",{body:"Habit time!"});
}
},10000);

/* SOUND */
function unlockSound(){
tickSound.play().then(()=>{
  tickSound.pause();
  tickSound.currentTime=0;
  soundReady=true;
});
}

/* THEME */
let theme=+localStorage.getItem("theme")||1;
function changeTheme(){
theme++; if(theme>10) theme=1;
localStorage.setItem("theme",theme);
document.body.className="theme-"+theme;
}
document.body.className="theme-"+theme;

/* WATER & WEIGHT */
function saveWater(){localStorage.setItem("water",water.value);updateStats();}
function saveWeight(){localStorage.setItem("weight",weight.value);updateStats();}
function updateStats(){statsShow.innerText=`üíß${localStorage.getItem("water")||0} | ‚öñÔ∏è${localStorage.getItem("weight")||0}`}

/* STREAK */
function updateStreak(){
let s=0;
let d=new Date(today);
while(true){
  let rowDone=false;
  for(let i=0;i<habits;i++){
    let k=`${d.getFullYear()}-${d.getMonth()}_${d.getDate()}_${i}`;
    if(localStorage.getItem(k)==="1") rowDone=true;
  }
  if(!rowDone) break;
  s++; d.setDate(d.getDate()-1);
}
localStorage.setItem("streak",s);
streakShow.innerText="üî• Streak: "+s;
}

/* TABLE */
function changeWeek(v){weekOffset+=v;render();}
function weekStart(d){let x=new Date(d);x.setDate(x.getDate()-x.getDay());return x;}

function render(){
let start = weekStart(new Date(today.getTime()+weekOffset*7*86400000));
monthYear.innerText = start.toLocaleString("default",{month:"long",year:"numeric"});
weekTitle.innerText = start.toDateString();

/* HEADERS */
let names=JSON.parse(localStorage.getItem("habitNames")||"[]");
let row=`<th>Date</th><th>Day</th>`;
for(let i=0;i<habits;i++) row+=`<th>${names[i]||"Habit "+(i+1)}</th>`;
row+=`<th>%</th>`;
habitHeadRow.innerHTML=row;

/* BODY */
chartBody.innerHTML="";
for(let i=0;i<7;i++){
let d=new Date(start); d.setDate(start.getDate()+i);
let isToday = d.toDateString()===today.toDateString();
let tr=document.createElement("tr");
if(isToday) tr.classList.add("today");
let r=`<td>${d.getDate()}</td><td>${days[d.getDay()]}</td>`;
for(let h=0;h<habits;h++){
  let key=`${d.getFullYear()}-${d.getMonth()}_${d.getDate()}_${h}`;
  let ch = localStorage.getItem(key)==="1";
  r+=`<td><input type="checkbox" ${ch?'checked':''}
  ${!isToday?'disabled':''}
  onclick="saveTick('${key}',this)">
  </td>`;
}
r+=`<td class="per">0%</td>`;
tr.innerHTML=r; chartBody.appendChild(tr);
}
calcPercent();
}

function saveTick(k,el){
localStorage.setItem(k,el.checked?"1":"0");
if(soundReady){tickSound.currentTime=0; tickSound.play();}
updateStreak(); calcPercent();
}

function calcPercent(){
document.querySelectorAll(".per").forEach(per=>{
let row=per.parentNode;
let done=row.querySelectorAll("input:checked").length;
per.innerText=Math.round(done/habits*100)+"%";
});
}

/* INIT */
loadProfile();
render();
</script>
</body>
</html>
