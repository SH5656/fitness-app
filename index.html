<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fitness Habit App</title>

<style>
*{box-sizing:border-box}

/* THEMES */
:root{
  --bg:#e8f5e9; --card:#fff; --accent:#2ecc71;
}
body.theme-1{--bg:#e8f5e9;--card:#fff;--accent:#2ecc71;}
body.theme-2{--bg:#e3f2fd;--card:#fff;--accent:#2196f3;}
body.theme-3{--bg:#fff3e0;--card:#fff;--accent:#ff9800;}
body.theme-4{--bg:#fce4ec;--card:#fff;--accent:#e91e63;}
body.theme-5{--bg:#ede7f6;--card:#fff;--accent:#673ab7;}
body.theme-6{--bg:#f3e5f5;--card:#fff;--accent:#9c27b0;}
body.theme-7{--bg:#e0f2f1;--card:#fff;--accent:#009688;}
body.theme-8{--bg:#fbe9e7;--card:#fff;--accent:#ff5722;}
body.theme-9{--bg:#eceff1;--card:#fff;--accent:#607d8b;}
body.theme-10{--bg:#fffde7;--card:#fff;--accent:#fbc02d;}

body{
  margin:0;
  background:var(--bg);
  font-family:Segoe UI,Arial;
  padding:12px;
}
.app{
  max-width:480px;
  margin:auto;
  background:var(--card);
  padding:16px;
  border-radius:18px;
  box-shadow:0 10px 25px rgba(0,0,0,.2);
}

/* PROFILE */
.profile{
  display:flex;
  align-items:center;
  gap:12px;
  margin-bottom:8px;
}
.profile img{
  width:60px;height:60px;
  border-radius:50%;object-fit:cover;background:#ccc;
}
.stats{font-size:14px}
.stats div{margin:2px 0}

/* TABLE */
.table-wrap{overflow-x:auto}
table{
  width:100%;border-collapse:collapse;
  font-size:13px;min-width:720px
}
th,td{
  border:1px solid #ccc;padding:6px;text-align:center
}
th{background:#e7e7e7}
.today{background:#fff4a8}
input[type=checkbox]{transform:scale(1.2)}

button,input{
  width:100%;padding:10px;margin:6px 0;font-size:15px;
  border-radius:10px;
}
button{border:none;background:var(--accent);color:#fff}
.card{background:#f1f1f1;padding:12px;border-radius:14px;margin-top:12px}
</style>
</head>

<body>

<div class="app">

<!-- PROFILE HEADER -->
<div class="profile">
  <img id="profilePic">
  <div class="stats">
    <div id="userNameShow">üë§ Your Name</div>
    <div id="streakShow">üî• Streak: 0</div>
    <div id="statsShow">üíß0 | ‚öñÔ∏è0</div>
  </div>
</div>

<input type="text" id="userName" placeholder="Enter name">
<input type="file" id="photoInput" accept="image/*">
<button onclick="saveProfile()">Save Profile</button>
<button onclick="unlockSound()">üîä Enable Tick Sound</button>
<button onclick="changeTheme()">üé® Change Theme</button>

<h2 id="monthYear"></h2>
<h3 id="weekTitle"></h3>

<div style="display:flex;gap:6px">
<button onclick="changeWeek(-1)">‚¨Ö Prev</button>
<button onclick="changeWeek(1)">Next ‚û°</button>
</div>

<div class="table-wrap card">
<table>
<thead>
<tr>
<th>Date</th><th>Day</th>
<th>Goal</th><th>Sleep</th><th>Wake</th>
<th>Food</th><th>Study</th><th>Run</th>
<th>Exercise</th><th>Book</th>
<th>%</th>
</tr>
</thead>
<tbody id="chartBody"></tbody>
</table>
</div>

<div class="card">
<h3>üíß Water</h3>
<input type="number" id="water" placeholder="glasses">
<button onclick="saveWater()">Save</button>
</div>

<div class="card">
<h3>‚öñÔ∏è Weight</h3>
<input type="number" step="0.1" id="weight" placeholder="kg">
<button onclick="saveWeight()">Save</button>
</div>

</div>

<audio id="tickSound" preload="auto">
<source src="https://assets.mixkit.co/sfx/preview/mixkit-click-1124.mp3">
</audio>

<script>
/* ===== CORE VARIABLES ===== */
const habits = 8;
const days=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];
let today=new Date(); today.setHours(0,0,0,0);
let weekOffset = 0;

/* ===== SOUND ===== */
let soundReady=false;
function unlockSound(){
  const a=document.getElementById("tickSound");
  a.play().then(()=>{
    a.pause(); a.currentTime=0;
    soundReady=true;
  });
}

/* ===== PROFILE ===== */
function saveProfile(){
  let n=document.getElementById("userName").value;
  if(n) localStorage.setItem("userName",n);

  let f=document.getElementById("photoInput").files[0];
  if(f){
    let r=new FileReader();
    r.onload=()=>localStorage.setItem("profilePic",r.result);
    r.readAsDataURL(f);
  }
  loadProfile();
}
function loadProfile(){
  let n=localStorage.getItem("userName")||"Your Name";
  let p=localStorage.getItem("profilePic");
  userNameShow.innerText="üë§ "+n;
  if(p) profilePic.src=p;
  updateStats();
  updateStreak();
}

/* ===== THEME ===== */
let theme=Number(localStorage.getItem("theme"))||1;
function applyTheme(){
  document.body.className="theme-"+theme;
}
function changeTheme(){
  theme++; if(theme>10) theme=1;
  localStorage.setItem("theme",theme);
  applyTheme();
}

/* ===== TABLE RENDER ===== */
function changeWeek(v){weekOffset+=v; render();}
function weekStart(d){let x=new Date(d);x.setDate(x.getDate()-x.getDay());return x;}

function render(){
  let start = weekStart(new Date(today.getTime()+weekOffset*7*86400000));
  monthYear.innerText = start.toLocaleString("default",{ month:"long",year:"numeric" });
  weekTitle.innerText = "Week of "+start.toDateString();

  let tbody=document.getElementById("chartBody");
  tbody.innerHTML="";

  for(let i=0;i<7;i++){
    let d=new Date(start); d.setDate(start.getDate()+i);
    if(Math.abs(d - today) > 40*86400000) continue; // stability

    let isToday=d.toDateString()===today.toDateString();
    let tr=document.createElement("tr");
    if(isToday) tr.classList.add("today");

    let row=`<td>${d.getDate()}</td><td>${days[d.getDay()]}</td>`;
    for(let h=0;h<habits;h++){
      let key=`${d.getFullYear()}-${d.getMonth()}_${d.getDate()}_${h}`;
      let ch = localStorage.getItem(key)==="1";
      row+=`<td>
      <input type="checkbox"
      ${ch?'checked':''}
      ${!isToday?'disabled':''}
      onclick="saveHabit('${key}',this)">
      </td>`;
    }
    row+=`<td class="per"></td>`;
    tr.innerHTML=row;
    tbody.appendChild(tr);
  }
  calcPercent();
}

/* ===== HABITS SAVE ===== */
function saveHabit(key,el){
  localStorage.setItem(key,el.checked?"1":"0");
  if(soundReady){
    tickSound.currentTime=0;
    tickSound.play();
  }
  updateStreak(); calcPercent();
}

/* ===== PERCENT ===== */
function calcPercent(){
  document.querySelectorAll(".per").forEach(per=>{
    let row=per.parentNode;
    let done=row.querySelectorAll("input:checked").length;
    per.innerText=Math.round(done/habits*100)+"%";
  });
}

/* ===== STREAK (Perfect Fix) ===== */
function updateStreak(){
  let s=0;
  let d=new Date(today);

  while(true){
    let key=`${d.getFullYear()}-${d.getMonth()}_${d.getDate()}_0`;
    let rowHasTick=false;

    for(let i=0;i<habits;i++){
      let k=`${d.getFullYear()}-${d.getMonth()}_${d.getDate()}_${i}`;
      if(localStorage.getItem(k)==="1") rowHasTick=true;
    }

    if(!rowHasTick) break;
    s++;
    d.setDate(d.getDate()-1);
  }

  streakShow.innerText="üî• Streak: "+s;
  localStorage.setItem("streak",s);
}

/* ===== WATER/WEIGHT ===== */
function saveWater(){
  localStorage.setItem("water",water.value);
  updateStats();
}
function saveWeight(){
  localStorage.setItem("weight",weight.value);
  updateStats();
}
function updateStats(){
  statsShow.innerText=`üíß${localStorage.getItem("water")||0} | ‚öñÔ∏è${localStorage.getItem("weight")||0}`;
}

/* INIT */
applyTheme();
loadProfile();
render();
</script>
</body>
</html>

