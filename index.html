<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fitness Habit App</title>

<style>
*{box-sizing:border-box}
:root{
  --bg:#e8f5e9; --card:#fff; --accent:#2ecc71;
}
body{margin:0;font-family:Segoe UI,Arial;background:var(--bg);padding:12px;}
.app{
  max-width:480px;margin:auto;background:var(--card);
  padding:16px;border-radius:18px;
  box-shadow:0 10px 25px rgba(0,0,0,.2);
}

/* Header */
.profile-header{
  display:flex;align-items:center;gap:12px;margin-bottom:10px;
}
.profile-header img{
  width:60px;height:60px;border-radius:50%;object-fit:cover;background:#ccc;
}
.profile-info{
  font-size:14px;
}
.profile-info div{margin:2px 0;}
.streak{font-size:16px;font-weight:bold;color:var(--accent);}

button,input{width:100%;padding:10px;margin:6px 0;font-size:15px;border-radius:10px;}

button{background:var(--accent);color:#fff;border:none;}
.card{background:#f2f2f2;padding:12px;border-radius:14px;margin-top:12px}

/* Table */
.table-wrap{overflow-x:auto}
table{min-width:720px;width:100%;border-collapse:collapse;font-size:13px}
th,td{border:1px solid #ccc;padding:6px;text-align:center}
th{background:#e7e7e7}
.today{background:#fff6b0}
input[type=checkbox]{transform:scale(1.2)}

</style>
</head>
<body>

<div class="app">

<!-- HEADER -->
<div class="profile-header">
  <img id="profilePic">
  <div class="profile-info">
    <div id="userNameShow">üë§ Your Name</div>
    <div class="streak" id="streakShow">üî• Streak: 0</div>
    <div id="statsShow">üíß0 | ‚öñÔ∏è0</div>
  </div>
</div>

<input type="text" id="userName" placeholder="Enter your name">
<input type="file" id="photoInput" accept="image/*">
<button onclick="saveProfile()">Save Profile</button>

<button onclick="unlockSound()">üîä Enable Sound</button>
<button onclick="changeTheme()">üé® Change Theme</button>

<h2 id="monthYear"></h2>
<h3 id="weekTitle"></h3>

<!-- WEEK NAVIGATION -->
<div style="display:flex;gap:6px">
<button onclick="changeWeek(-1)">‚¨Ö Prev</button>
<button onclick="changeWeek(1)">Next ‚û°</button>
</div>

<!-- HABIT TABLE -->
<div class="table-wrap card">
<table>
<thead>
<tr>
<th>Date</th><th>Day</th>
<th>Goal</th><th>Sleep</th><th>Wake</th>
<th>Food</th><th>Study</th><th>Run</th>
<th>Exercise</th><th>Book</th><th>%</th>
</tr>
</thead>
<tbody id="chartBody"></tbody>
</table>
</div>

<!-- WATER -->
<div class="card">
<h3>üíß Water</h3>
<input type="number" id="water" placeholder="glasses">
<button onclick="saveWater()">Save</button>
</div>

<!-- WEIGHT -->
<div class="card">
<h3>‚öñÔ∏è Weight</h3>
<input type="number" step="0.1" id="weight" placeholder="KG">
<button onclick="saveWeight()">Save</button>
</div>

<!-- REMINDER -->
<div class="card">
<h3>üîî Reminder</h3>
<input type="time" id="reminderTime">
<button onclick="setReminder()">Set Reminder</button>
</div>

</div>

<!-- Sound -->
<audio id="tickSound" preload="auto">
<source src="https://assets.mixkit.co/sfx/preview/mixkit-click-1124.mp3">
</audio>

<script>
/* CONSTANTS */
const days=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];
const habits=8;
let today=new Date(); today.setHours(0,0,0,0);
let weekOffset=0;

/* SOUND */
let soundReady=false;
function unlockSound(){
  const a=document.getElementById("tickSound");
  a.play().then(()=>{
    a.pause(); a.currentTime=0;
    soundReady=true;
    alert("Sound Enabled!");
  });
}

/* PROFILE */
function saveProfile(){
  let n=document.getElementById("userName").value;
  if(n){
    localStorage.setItem("userName",n);
  }
  const file=document.getElementById("photoInput").files[0];
  if(file){
    const r=new FileReader();
    r.onload=()=>localStorage.setItem("profilePic",r.result);
    r.readAsDataURL(file);
  }
  loadProfile();
}

function loadProfile(){
  let n=localStorage.getItem("userName")||"Your Name";
  let p=localStorage.getItem("profilePic");
  userNameShow.innerText="üë§ "+n;
  if(p) profilePic.src=p;
  updateStats();
  updateStreak();
}

/* HABITS TABLE */
function changeWeek(v){weekOffset+=v;render();}
function weekStart(d){let x=new Date(d);x.setDate(x.getDate()-x.getDay());return x;}

function render(){
  let start=weekStart(new Date(today.getTime()+weekOffset*7*86400000));
  document.getElementById("monthYear").innerText=today.toLocaleString("default",{month:"long",year:"numeric"});
  document.getElementById("weekTitle").innerText="Week of "+start.toDateString();
  let body=document.getElementById("chartBody"); body.innerHTML="";
  for(let i=0;i<7;i++){
    let d=new Date(start); d.setDate(start.getDate()+i);
    if(d.getMonth()!=today.getMonth()) continue;
    let isToday=d.toDateString()===today.toDateString();
    let row=document.createElement("tr");
    if(isToday) row.classList.add("today");
    let html=`<td>${d.getDate()}</td><td>${days[d.getDay()]}</td>`;
    for(let h=0;h<habits;h++){
      let key=`${today.getFullYear()}-${today.getMonth()}_${d.getDate()}_${h}`;
      let ch=localStorage.getItem(key)==="1";
      html+=`<td><input type="checkbox"
       ${ch?'checked':''}
       onclick="saveHabit('${key}',this)"
       ${!isToday?'disabled':''}></td>`;
    }
    html+=`<td class="per"></td>`;
    row.innerHTML=html;
    body.appendChild(row);
  }
  calcPercent();
}

/* HABIT SAVE */
function saveHabit(key,el){
  localStorage.setItem(key,el.checked?'1':'0');
  if(soundReady){
    tickSound.currentTime=0;
    tickSound.play();
  }
  updateStreak(); calcPercent();
}

/* PERCENT CALC */
function calcPercent(){
  document.querySelectorAll("tbody tr").forEach(r=>{
    let boxes=r.querySelectorAll("input");
    let done=[...boxes].filter(b=>b.checked).length;
    r.querySelector(".per").innerText=Math.round(done/habits*100)+"%";
  });
}

/* STREAK FIXED */
function updateStreak(){
  let s=0;
  let d=new Date(today);
  while(true){
    let k=`done_${d.toDateString()}`;
    if(!localStorage.getItem(k)) break;
    s++; d.setDate(d.getDate()-1);
  }
  let todayKey="done_"+today.toDateString();
  if(document.querySelector(".today input:checked")) localStorage.setItem(todayKey,"yes");

  localStorage.setItem("streak",s);
  streakShow.innerText="üî• Streak: "+s;
}

/* WATER / WEIGHT */
function saveWater(){
  localStorage.setItem("water",document.getElementById("water").value||0);
  updateStats();
}
function saveWeight(){
  localStorage.setItem("weight",document.getElementById("weight").value||0);
  updateStats();
}
function updateStats(){
  let w=localStorage.getItem("water")||0;
  let kg=localStorage.getItem("weight")||0;
  statsShow.innerText=`üíß${w} | ‚öñÔ∏è${kg}`;
}

/* THEME */
let theme=localStorage.getItem("theme")||1;
document.body.className="theme-"+theme;
function changeTheme(){
  theme++; if(theme>10) theme=1;
  localStorage.setItem("theme",theme);
  document.body.className="theme-"+theme;
}

/* REMINDER */
function setReminder(){
  let t=document.getElementById("reminderTime").value;
  if(!t) return;
  localStorage.setItem("reminderTime",t);
  Notification.requestPermission();
  alert("Reminder saved");
}

loadProfile(); render();
</script>

</body>
</html>
